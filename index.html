<!DOCTYPE html>
	<head>
		<meta charset="UTF-8">
		<title>Jonathan Moo's Github Bio</title>


		<link rel='stylesheet' id='bootstrap-css'  href='css/bootstrap.min.css' type='text/css' media='all' />
		<link rel='stylesheet' id='bootstrap-grid-css'  href='css/bootstrap-grid.min.css' type='text/css' media='all' />
		<link rel='stylesheet' id='custom-css'  href='css/style.css' type='text/css' media='all' /> 
		<script src="https://d3js.org/d3.v5.min.js"></script>
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	</head>

	<body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<a class="navbar-brand" href="#">Jonathan's Github Page</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item active">
						<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/11.2/index.html">11.2 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/11.3/index.html">11.3 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/12.1/index.html">12.1 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/12.3/index.html">12.3 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/13.1/index.html">13.1 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/13.2/index.html">13.2 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/13.3/index.html">13.3 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/14.1/index.html">14.1 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/14.2/index.html">14.2 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/14.3/index.html">14.3 Ref</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="MIACOR201901DATA3/15.1/index.html">15.1 Ref</a>
					</li>
				</ul>
			</div>
		</nav>
		<div class="container-fluid">
			<div class="row">
				<div id="main-content" class="col-md-8">
					<div class="objective-block">
						<h3 id="objectives">Objectives For Lesson 15.2</h3>

						<ul>
							<li>Javascript!</li>
							<ul>
								<li>We'll explore the Plotly library today.</li>
							</ul>
						</ul>

						
					</div>

					<div id="why-we-learn" class="instructor-block">
						<h3>Why We Learn?</h3>
						
						<p><a href="https://d3js.org/">D3 means "Data-Driven Documents".</a> It's <strong>not only</strong> plotting nice graphs and make awesome visualization. The main purpose of D3 is about manipulating DOM (Document Object Model).</p>

						<h5>You might ask, what is DOM?</h5>

						<p>You've been dealing HTML for some time, and DOM is simply represented by the tags which you've been using. We call the tags within a HTML as "DOM elements".</p>

						<p>The power to manipulate the tags or DOM elements <strong>without reloading the page</strong> is the reason why we can put awesome visualizations on the web.</p>

						<p>This is for Data Visualization Engineers, which is a very specialized field.</p>

					</div>

					<div id="01-Ins_Dropdown_Events" class="instructor-block">
						<h3>01-Ins_Dropdown_Events</h3>

						<p>We are going to take some time to rehash some principles before moving forward.</p>
						
						<p>Last lesson, we created basic graphs.</p>

						<p>This lesson, we're going to add additional interactivity to the graphs. One of the ways we do that is using <code>select</code> tags.</p>

						<div id="HTML-Select">
							<div class="row">
								<div class="col-md-12">
									<h4>Let's talk about the <code>select</code> tag.</h4>
								</div>
								<div class="col-md-6">
								<h6>Raw HTML Version</h6>
								 <select id="selDataset" onchange="printData(this.value)">
								    <option value="dataset1">DataSet1</option>
								    <option value="dataset2">DataSet2</option>
								    <option value="dataset3">DataSet3</option>
								  </select>
								</div>
								<div class="col-md-6">
									<h6><a href="https://getbootstrap.com/docs/4.0/components/forms/">Bootstrap Version</a></h6>

									<select class="form-control" id="exampleFormControlSelect1" onchange="printData(this.value)">
								      <option>1</option>
								      <option>2</option>
								      <option>3</option>
								      <option>4</option>
								      <option>5</option>
								    </select>
								</div>
							</div>

							<div class="row">
								<div class="col-md-12">
									<h4>What does this mean?</h4>

									<p>The <code>select</code> tag is inbuilt within <strong>HTML</strong>, not <strong>Javascript</strong>. This is important to note so that you don't build things from scratch when it is freely given to you.</p>

									<p>You'll notice within my HTML, there is this portion on the HTML tag: <code>onchange="printData(this.value)"</code></p>

									<p>The first time I introduced this is in <strong>Lesson 14.3</strong>. It was not part of the curriculum, but I thought it was important for you to note that HTML can contain Javascript functions and it can be invoked when triggered.</p>

									<p>This is the function:</p>
									<pre>
										<code>
			function printData(value){
				console.log(value);
			}
										</code>
									</pre>

									<p>So within the function, you can:</p>
									<ul>
										<li>Collect data value which was selected</li>
										<li>Do something to that value.</li>
									</ul>
								</div>
							</div> <!-- end .row -->
						</div> <!-- end #HTML-Select -->

						<div id="raw-DOM-element">
							<p>You'll see in your notes a piece of code like this: <code>var LINE = document.getElementById("plot");</code></p>

							<p>And you're wondering, <strong>WHAT ON EARTH IS THAT?</strong></p>

							<h4>This is DOM element manipulation.</h4>

							<p>You've been using the D3 library to select stuff, like: <code>d3.select("#HTML-Select");</code></p>

							<p>The above is equivalent to <code>document.getElementById("HTML-Select");</code> This means, your browser has the ability to parse the HTML tags natively without any Javascript libraries!</p>

							<p>The differences are:</p>

							<ul>
								<li><code>document</code> methods are more clunky. To get IDs, you have to use <code>document.getElementById</code>. To get classes, you have to use <code>document.getElementsClassName</code>, but <code>d3.select</code> helps us to differentiate IDs and classes with CSS conventions, such as <code>d3.select("#HTML-Select");</code> for IDS, and <code>d3.select(".instructor-block");</code></li>
								<li>To reference an element within an element with raw DOM elements, you would have to keep chaining the <code>document</code> variable.</li>
								<ul>
									<li><code>document.getElementById("HTML-Select").getElementsByClassName("row");</code> will give you the values from the class name <code>row</code> <strong>within</strong> the ID <code>HTML-Select</code>.</li>
								</ul>
								<li>But to do the same above with d3, you would just need to do: <code>d3.select("#HTML-Select .row").html()</code></li>
							</ul>

							<h4>You're going to ask, why even learn raw DOM elements? Just use D3!</h4>

							<p>But you must understand a corporation's perspective. D3 isn't created by your company. D3 is subject to change because it is created by others.</p>

							<p>If a library ceases to function, or if it changes, you are going to be handicapped by the changes! Thus, understanding the original syntax helps you to mitigate this problem!</p>

						</div><!-- end #raw-DOM-element -->

						<div id="01-plot-graph">
							<h4>Finally, let's plot graphs.</h4>

							<p>You're given this code in the first activity:</p>
							<pre>
								<code>
function init() {
  data = [{
    x: [1, 2, 3, 4, 5],
    y: [1, 2, 4, 8, 16] }];
  var LINE = document.getElementById("plot"); // in this HTML, I changed it to 01-plot so that I can put more plots in a single page.
  console.log(LINE);
  Plotly.plot(LINE, data);
}

function updatePlotly(newx, newy) {
  var LINE = document.getElementById("plot"); // in this HTML, I changed it to 01-plot so that I can put more plots in a single page.

  // Note the extra brackets around 'newx' and 'newy'
  // This is because it is trying to set an array to it.
  Plotly.restyle(LINE, "x", [newx]);
  Plotly.restyle(LINE, "y", [newy]);
}

function getData(dataset) {

  // Initialize empty arrays to contain our axes
  var x = [];
  var y = [];

  // Fill the x and y arrays as a function of the selected dataset
  // we prepare a new set of data here

  switch (dataset) {
  case "dataset1":
    x = [1, 2, 3, 4, 5];
    y = [0.1, 0.2, 0.3, 0.4, 0.5];
    break;
  case "dataset2":
    x = [10, 20, 30, 40, 50];
    y = [1, 10, 100, 1000, 10000];
    break;
  case "dataset3":
    x = [100, 200, 300, 400, 500];
    y = [10, 100, 50, 10, 0];
    break;
  default:
    x = [1, 2, 3, 4, 5];
    y = [1, 2, 3, 4, 5];
    break;
  }

  updatePlotly(x, y);
}

init();
								</code>
							</pre>

							<p>The plot generates here:</p>
							<div id="01-plot"></div>

							<p>And this is our <code>select</code> dropdown:</p>

							<select id="selDataset" onchange="getData(this.value)">
							    <option value="dataset1">DataSet1</option>
							    <option value="dataset2">DataSet2</option>
							    <option value="dataset3">DataSet3</option>
							  </select>

							<p>Looking at the code, what gets invoked first?</p>
						</div>

					</div> 

					<div id="02-Stu_Dropdown_Events" class="student-block">
						<h3>02-Stu_Dropdown_Events: Your Turn</h3>
					</div>

					<div id="03-Ins_D3_JSON" class="instructor-block">
						<h3>03-Ins_D3_JSON</h3>

						<p>You're given this code:</p>

						<pre>
							<code>
const url = "https://api.spacexdata.com/v2/launchpads";

// Fetch the JSON data and console log it
d3.json(url).then(function(data) {
  console.log(data);
});

// Promise Pending
const dataPromise = d3.json(url);
console.log("Data Promise: ", dataPromise);
							</code>
						</pre>

						<p>D3 allows you to retrieve data from API urls and parse it into variables automatically for you!</p>

						<p>Then, we decide to confuse you with the <strong>Promise</strong> concept in Javascript, which is found here:</p>

						<pre>
							<code>
// Promise Pending
const dataPromise = d3.json(url);
console.log("Data Promise: ", dataPromise);	
							</code>
						</pre>

						<p>So, let me explain the idea of <strong>Promises</strong>.</p>

						<p>In English, we promise something, but we are only giving the assurance that we will do it. <strong>WE HAVE NOT DELIVERED YET.</strong> <em>And thus, the make or break of many marriages. (joking).</em></p>

						<p>In Javascript, there are many components within a page which calls different APIs and data. <strong>You may request data from an API, but that doesn't mean the data will deliver!</strong></p>

						<p><em>Side note: this behavior is called asynchronous. Synchronous is what you're used to, when code will break if a certain portion has errors. Async code WILL NOT BREAK and continue with the errors <strong>because different portions of code are independant of each other</strong>.</em></p>

						<p>So some guy named this concept as <strong>Promise</strong>, and say if the data DOES DELIVER, we receive the data within a <strong>callback function</strong>. If the data DOES NOT DELIVER, we trigger an error <strong>within the same callback function</strong>.</p>

						<p>There is a <strong>Promise</strong> object within the browser. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">It has three states:</a></p>
						<ul>
							<li>Pending <em>(The start of marriages)</em></li>
							<li>Fulfilled <em>(Disneyland kind of marriages)</em></li>
							<li>Rejected <em>(You realized you're not in Disneyland.)</em></li>
						</ul>

						<h4>BUT, let's not go there yet. Unless you want to stay here till midnight.</h4>

						<pre>
							<code>
// Promise Pending
const dataPromise = d3.json(url);
console.log("Data Promise: ", dataPromise);	
							</code>
						</pre>

						<p>The promise here holds the response which is either one of the 3 states above, and/or the data if available.</p>
					</div>

					<div id="04-Stu_Stocks" class="student-block">
						<h3>04-Stu_Stocks: Your Turn</h3>

						<p>When you try to do the activity, you will meet errors. That's because you have to <strong>SIGN UP</strong> for your own API key in <a href="https://www.quandl.com/">Quandl.com</a> to fetch stock data.</p>

						<pre>
							<code>
var apiKey = "your_api_key"; // Register with the link above

var url =
  `https://www.quandl.com/api/v3/datasets/WIKI/AMZN.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

/**
 * Helper function to select stock data
 * Returns an array of values
 * @param {array} rows
 * @param {integer} index
 * index 0 - Date
 * index 1 - Open
 * index 2 - High
 * index 3 - Low
 * index 4 - Volume
 */
function unpack(rows, index) {
	// You have to see what is the data to understand how this works
  return rows.map(function(row) {
    return row[index];
  });
}

function buildPlot() {
  d3.json(url).then(function(data) {

    // DO IT YOURSELF. SOME HELPING CODE TO GET STARTED

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("plot", data, layout); // Rename it to the relevant HTML

  });
}

buildPlot();
							</code>
						</pre>

						<p>It plots here:</p>

						<div id="04-plot"></div>

						<p>The goal is:</p>
						<ul>
							<li>Break it apart to see what is the data.</li>
							<li>Organize your data</li>
							<li>Do your layout</li>
							<li>Plot the graph</li>
						</ul>

					</div>

					<div id="05-Stu_Stocks_Dynamic" class="student-block">
						<h3>05-Stu_Stocks_Dynamic: Your Turn</h3>

						<p>It's the same as the above graph, except that you must allow the user to input the stock name. <strong>You're going to code only the portion where a user inputs a value.</strong></p>

						<p>From this to the end of all student activities, <strong>you're building it incrementally</strong> and not from scatch.</p>

						<p>Example Stock Names:</p>
						<ul>
							<li>AMD</li>
							<li>FB</li>
							<li>TSLA</li>
						</ul>

						<pre>
							<code>
/**
 * Helper function to select stock data
 * Returns an array of values
 * @param {array} rows
 * @param {integer} index
 * index 0 - Date
 * index 1 - Open
 * index 2 - High
 * index 3 - Low
 * index 4 - Volume
 */
function unpack(rows, index) {
  return rows.map(function(row) {
    return row[index];
  });
}

// Submit Button handler
function handleSubmit() {
  // Prevent the page from refreshing
  d3.event.preventDefault();

  // Select the input value from the form

  // clear the input value

  // Build the plot with the new stock
  buildPlot(stock);
}

function buildPlot(stock) {
  var apiKey = "your_api_key";

  var url = `https://www.quandl.com/api/v3/datasets/WIKI/${stock}.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

  d3.json(url).then(function(data) {

    // Grab values from the response json object to build the plots
    var name = data.dataset.name;
    var stock = data.dataset.dataset_code;
    var startDate = data.dataset.start_date;
    var endDate = data.dataset.end_date;
    var dates = unpack(data.dataset.data, 0);
    var closingPrices = unpack(data.dataset.data, 1);

    var trace1 = {
      type: "scatter",
      mode: "lines",
      name: name,
      x: dates,
      y: closingPrices,
      line: {
        color: "#17BECF"
      }
    };

    var data = [trace1];

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("plot", data, layout);

  });
}

// Add event listener for submit button
d3.select("#submit").on("click", handleSubmit);

							</code>
						</pre>

						<p>It plots here if you put an input:</p>

						<form class="form-inline">
						    <div class="form-group">
						      <input type="text" class="form-control stockInput" id="stockInput" placeholder="Enter a stock">
						    </div>
						    <button id="submit" type="submit" class="btn btn-default submit">Plot Stock</button>
						  </form>

						  <div class="row">
						  	<div class="col-md-12">
								<div id="05-plot"></div>
							</div>
						</div>
					</div>

					<div id="06-Stu_Stocks_CandleStick" class="student-block">
						<h3>06-Stu_Stocks_CandleStick: Your Turn</h3>
						<pre>
							<code>
/**
 * Helper function to select stock data
 * Returns an array of values
 * @param {array} rows
 * @param {integer} index
 * index 0 - Date
 * index 1 - Open
 * index 2 - High
 * index 3 - Low
 * index 4 - Close
 * index 5 - Volume
 */
function unpack(rows, index) {
  return rows.map(function(row) {
    return row[index];
  });
}

// Submit Button handler
function handleSubmit() {
  // Prevent the page from refreshing
  d3.event.preventDefault();

  // Select the input value from the form
  var stock = d3.select("#stockInput").node().value;
  console.log(stock);

  // clear the input value
  d3.select("#stockInput").node().value = "";

  // Build the plot with the new stock
  buildPlot(stock);
}

function buildPlot(stock) {
  var apiKey = "your_api_key";

  var url = `https://www.quandl.com/api/v3/datasets/WIKI/${stock}.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

  d3.json(url).then(function(data) {

    // Grab values from the response json object to build the plots
    var name = data.dataset.name;
    var stock = data.dataset.dataset_code;
    var startDate = data.dataset.start_date;
    var endDate = data.dataset.end_date;
    var dates = unpack(data.dataset.data, 0);

	// @TODO: Unpack the open, close, high, and low prices

    var trace1 = {
      type: "scatter",
      mode: "lines",
      name: name,
      x: dates,
      y: closingPrices,
      line: {
        color: "#17BECF"
      }
    };

    // Candlestick Trace
    var trace2 = {
      type: "candlestick",
      x: dates,
      high: highPrices,
      low: lowPrices,
      open: openingPrices,
      close: closingPrices
    };

    var data = [trace1, trace2];

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("plot", data, layout);
  });
}

// Add event listener for submit button
d3.select("#submit").on("click", handleSubmit);				
							</code>
						</pre>
						<p>It plots here if you put an input:</p>

						  <div class="row">
						  	<div class="col-md-12">
								<div id="06-plot"></div>
							</div>
						</div>
					</div>

					<div id="07-Stu_Stocks_Rolling_Avg" class="student-block">
						<h3>07-Stu_Stocks_Rolling_Avg: Your Turn</h3>
						<pre>
							<code>
/**
 * Helper function to select stock data
 * Returns an array of values
 * @param {array} rows
 * @param {integer} index
 * index 0 - Date
 * index 1 - Open
 * index 2 - High
 * index 3 - Low
 * index 4 - Close
 * index 5 - Volume
 */
function unpack(rows, index) {
  return rows.map(function(row) {
    return row[index];
  });
}

// Calculate a rolling average for an array
function rollingAverage(arr, windowPeriod = 10) {
  // rolling averages array to return
  var averages = [];

 // @TODO: YOUR CODE HERE


  return averages;
}

// Submit Button handler
function handleSubmit() {
  // Prevent the page from refreshing
  d3.event.preventDefault();

  // Select the input value from the form
  var stock = d3.select("#stockInput").node().value;
  console.log(stock);

  // clear the input value
  d3.select("#stockInput").node().value = "";

  // Build the plot with the new stock
  buildPlot(stock);
}

function buildPlot(stock) {
  var apiKey = "ppvzoohSZsStRq8whQr9";

  var url = `https://www.quandl.com/api/v3/datasets/WIKI/${stock}.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

  d3.json(url).then(function(data) {

    // Grab values from the response json object to build the plots
    var name = data.dataset.name;
    var stock = data.dataset.dataset_code;
    var startDate = data.dataset.start_date;
    var endDate = data.dataset.end_date;
    var dates = unpack(data.dataset.data, 0);
    var openingPrices = unpack(data.dataset.data, 1);
    var highPrices = unpack(data.dataset.data, 2);
    var lowPrices = unpack(data.dataset.data, 3);
    var closingPrices = unpack(data.dataset.data, 4);
    var rollingPeriod = 30;
    var rollingAvgClosing = rollingAverage(closingPrices, rollingPeriod);

    var trace1 = {
      type: "scatter",
      mode: "lines",
      name: name,
      x: dates,
      y: closingPrices,
      line: {
        color: "#17BECF"
      }
    };

    // Candlestick Trace
    var trace2 = {
      type: "candlestick",
      x: dates,
      high: highPrices,
      low: lowPrices,
      open: openingPrices,
      close: closingPrices
    };

    // Rolling Averages Trace
    var trace3 = {
      type: "scatter",
      mode: "lines",
      name: "Rolling",
      x: dates.slice(0, dates.length - rollingPeriod),
      y: rollingAvgClosing
    };

    var data = [trace1, trace2, trace3];

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("plot", data, layout);

  });
}

// Add event listener for submit button
d3.select("#submit").on("click", handleSubmit);
							</code>
						</pre>
						<p>It plots here if you put an input:</p>

						  <div class="row">
						  	<div class="col-md-12">
								<div id="07-plot"></div>
							</div>
						</div>
					</div>

					<div id="08-Stu_Stocks_Report" class="student-block">
						<h3>08-Stu_Stocks_Report: Your Turn</h3>

						<p>This is built upon everything you've learned before.</p>

					</div>

				</div> <!-- end #main-content -->


				<div id="right-sb" class="col-md-4">
					<div id="right-sb-nav" class="list-group" id="toc" role="tablist">
					  <a class="list-group-item list-group-item-action active"  href="#objectives" role="tab">Objectives</a>
					  <a class="list-group-item list-group-item-action"  href="#why-we-learn" role="tab">Why We Learn</a>
					  <a class="list-group-item list-group-item-action"  href="#01-Ins_Dropdown_Events" role="tab">01-Ins_Dropdown_Events</a>
					  <a class="list-group-item list-group-item-action"  href="#02-Stu_Dropdown_Events" role="tab">02-Stu_Dropdown_Events</a>
					  <a class="list-group-item list-group-item-action"  href="#03-Ins_D3_JSON" role="tab">03-Ins_D3_JSON</a>
					  <a class="list-group-item list-group-item-action"  href="#04-Stu_Stocks" role="tab">04-Stu_Stocks</a>
					  <a class="list-group-item list-group-item-action"  href="#05-Stu_Stocks_Dynamic" role="tab">05-Stu_Stocks_Dynamic</a>
					  <a class="list-group-item list-group-item-action"  href="#06-Stu_Stocks_CandleStick" role="tab">06-Stu_Stocks_CandleStick</a>
					  <a class="list-group-item list-group-item-action"  href="#07-Stu_Stocks_Rolling_Avg" role="tab">07-Stu_Stocks_Rolling_Avg</a>
					  <a class="list-group-item list-group-item-action"  href="#08-Stu_Stocks_Report" role="tab">08-Stu_Stocks_Report</a>
					</div>
				
				</div>
			</div> <!-- end .row -->
			
		</div> <!-- end .container-fluid -->

		<footer>
			<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
			<script type="text/javascript" src="js/bootstrap.min.js"></script>

			<script type="text/javascript">
// 01
function printData(value){
	console.log(value);
}

function init() {
  data = [{
    x: [1, 2, 3, 4, 5],
    y: [1, 2, 4, 8, 16] }];
  var LINE = document.getElementById("01-plot");
  console.log(LINE);
  Plotly.plot(LINE, data);
}

function updatePlotly(newx, newy) {
  var LINE = document.getElementById("01-plot");

  // Note the extra brackets around 'newx' and 'newy'
  Plotly.restyle(LINE, "x", [newx]);
  Plotly.restyle(LINE, "y", [newy]);
}

function getData(dataset) {

  // Initialize empty arrays to contain our axes
  var x = [];
  var y = [];

  // Fill the x and y arrays as a function of the selected dataset
  switch (dataset) {
  case "dataset1":
    x = [1, 2, 3, 4, 5];
    y = [0.1, 0.2, 0.3, 0.4, 0.5];
    break;
  case "dataset2":
    x = [10, 20, 30, 40, 50];
    y = [1, 10, 100, 1000, 10000];
    break;
  case "dataset3":
    x = [100, 200, 300, 400, 500];
    y = [10, 100, 50, 10, 0];
    break;
  default:
    x = [1, 2, 3, 4, 5];
    y = [1, 2, 3, 4, 5];
    break;
  }

  updatePlotly(x, y);
}

init();

// 04
var apiKey = "_o3wCfBk2R9sTS_kyH_x"; // Register with the link above

var url =
  `https://www.quandl.com/api/v3/datasets/WIKI/AMZN.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

/**
 * Helper function to select stock data
 * Returns an array of values
 * @param {array} rows
 * @param {integer} index
 * index 0 - Date
 * index 1 - Open
 * index 2 - High
 * index 3 - Low
 * index 4 - Volume
 */
function unpack(rows, index) {
  return rows.map(function(row) {
    return row[index];
  });
}

function buildPlot() {
  d3.json(url).then(function(data) {

    // Grab values from the data json object to build the plots
    var name = data.dataset.name;
    var stock = data.dataset.dataset_code;
    var startDate = data.dataset.start_date;
    var endDate = data.dataset.end_date;
    var dates = unpack(data.dataset.data, 0);
    var closingPrices = unpack(data.dataset.data, 1);

    var trace1 = {
      type: "scatter",
      mode: "lines",
      name: name,
      x: dates,
      y: closingPrices,
      line: {
        color: "#17BECF"
      }
    };

    var data = [trace1];

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("04-plot", data, layout); // Rename it to the relevant HTML

  });
}

buildPlot();

// 05

/**
 * Helper function to select stock data
 * Returns an array of values
 * @param {array} rows
 * @param {integer} index
 * index 0 - Date
 * index 1 - Open
 * index 2 - High
 * index 3 - Low
 * index 4 - Volume
 */
function unpack(rows, index) {
  return rows.map(function(row) {
    return row[index];
  });
}

// Submit Button handler
function handleSubmit() {
  // Prevent the page from refreshing
  d3.event.preventDefault();

  // Select the input value from the form
  var stock = d3.select(".stockInput").node().value;
  console.log(stock);

  // clear the input value
  d3.select(".stockInput").node().value = "";

  // Build the plot with the new stock
  buildDynamicPlot(stock);
  buildCandleStickPlot(stock);
  buildRollingAvgPlot(stock);
}

function buildDynamicPlot(stock) {
  var apiKey = "_o3wCfBk2R9sTS_kyH_x";

  var url = `https://www.quandl.com/api/v3/datasets/WIKI/${stock}.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

  d3.json(url).then(function(data) {

    // Grab values from the response json object to build the plots
    var name = data.dataset.name;
    var stock = data.dataset.dataset_code;
    var startDate = data.dataset.start_date;
    var endDate = data.dataset.end_date;
    var dates = unpack(data.dataset.data, 0);
    var closingPrices = unpack(data.dataset.data, 1);

    var trace1 = {
      type: "scatter",
      mode: "lines",
      name: name,
      x: dates,
      y: closingPrices,
      line: {
        color: "#17BECF"
      }
    };

    var data = [trace1];

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("05-plot", data, layout);

  });
}

function buildCandleStickPlot(stock) {
  var apiKey = "_o3wCfBk2R9sTS_kyH_x";

  var url = `https://www.quandl.com/api/v3/datasets/WIKI/${stock}.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

  d3.json(url).then(function(data) {

    // Grab values from the response json object to build the plots
    var name = data.dataset.name;
    var stock = data.dataset.dataset_code;
    var startDate = data.dataset.start_date;
    var endDate = data.dataset.end_date;
    var dates = unpack(data.dataset.data, 0);
    var openingPrices = unpack(data.dataset.data, 1);
    var highPrices = unpack(data.dataset.data, 2);
    var lowPrices = unpack(data.dataset.data, 3);
    var closingPrices = unpack(data.dataset.data, 4);

    var trace1 = {
      type: "scatter",
      mode: "lines",
      name: name,
      x: dates,
      y: closingPrices,
      line: {
        color: "#17BECF"
      }
    };

    // Candlestick Trace
    var trace2 = {
      type: "candlestick",
      x: dates,
      high: highPrices,
      low: lowPrices,
      open: openingPrices,
      close: closingPrices
    };

    var data = [trace1, trace2];

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("06-plot", data, layout);
  });
}

function rollingAverage(arr, windowPeriod = 10) {
  // rolling averages array to return
  var averages = [];

  // Loop through all of the data
  for (var i = 0; i < arr.length - windowPeriod + 1; i++) {
    // calculate the average for a window of data
    var sum = 0;
    for (var j = 0; j < windowPeriod; j++) {
      sum += arr[i + j];
    }
    // calculate the average and push it to the averages array
    averages.push(sum / windowPeriod);
  }
  return averages;
}

function buildRollingAvgPlot(stock) {
  var apiKey = "_o3wCfBk2R9sTS_kyH_x";

  var url = `https://www.quandl.com/api/v3/datasets/WIKI/${stock}.json?start_date=2016-10-01&end_date=2017-10-01&api_key=${apiKey}`;

  d3.json(url).then(function(data) {

    // Grab values from the response json object to build the plots
    var name = data.dataset.name;
    var stock = data.dataset.dataset_code;
    var startDate = data.dataset.start_date;
    var endDate = data.dataset.end_date;
    var dates = unpack(data.dataset.data, 0);
    var openingPrices = unpack(data.dataset.data, 1);
    var highPrices = unpack(data.dataset.data, 2);
    var lowPrices = unpack(data.dataset.data, 3);
    var closingPrices = unpack(data.dataset.data, 4);
    var rollingPeriod = 30;
    var rollingAvgClosing = rollingAverage(closingPrices, rollingPeriod);

    var trace1 = {
      type: "scatter",
      mode: "lines",
      name: name,
      x: dates,
      y: closingPrices,
      line: {
        color: "#17BECF"
      }
    };

    // Candlestick Trace
    var trace2 = {
      type: "candlestick",
      x: dates,
      high: highPrices,
      low: lowPrices,
      open: openingPrices,
      close: closingPrices
    };

    // Rolling Averages Trace
    var trace3 = {
      type: "scatter",
      mode: "lines",
      name: "Rolling",
      x: dates.slice(0, dates.length - rollingPeriod),
      y: rollingAvgClosing
    };

    var data = [trace1, trace2, trace3];

    var layout = {
      title: `${stock} closing prices`,
      xaxis: {
        range: [startDate, endDate],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      }
    };

    Plotly.newPlot("07-plot", data, layout);

  });
}

// Add event listener for submit button
d3.select(".submit").on("click", handleSubmit);

			</script>

		</footer>

	</body>


</html>